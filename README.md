# House and Apartment API

## Описание

"EIC MVP API" — это REST API, предназначенный для управления
информацией о домах и квартирах, а также для расчета стоимости коммунальных
услуг. API предоставляет функции для получения списка домов, подробной
информации о конкретных домах и квартирах, записи показаний счетчиков воды и
расчета стоимости коммунальных услуг.

## Используемые технологии

[![pre-commit](https://img.shields.io/badge/Python-3.11-3776AB?logo=python&logoColor=white)](https://www.python.org/downloads/release/python-3111/)
[![pre-commit](https://img.shields.io/badge/Django-3.2-092E20?logo=django&logoColor=white)](https://docs.djangoproject.com/en/4.2/releases/3.2/)
[![pre-commit](https://img.shields.io/badge/Django_REST_framework-3.12-800000?logo=djangorestramework&logoColor=white)](https://www.django-rest-framework.org/community/3.12-announcement/)
[![PostgreSQL](https://img.shields.io/badge/-PostgreSQL-464646?style=flat-square&logo=PostgreSQL)](https://www.postgresql.org/)
[![Nginx](https://img.shields.io/badge/-NGINX-464646?style=flat-square&logo=NGINX)](https://nginx.org/ru/)
[![gunicorn](https://img.shields.io/badge/-gunicorn-464646?style=flat-square&logo=gunicorn)](https://gunicorn.org/)
[![docker](https://img.shields.io/badge/-Docker-464646?style=flat-square&logo=docker)](https://www.docker.com/)
[![celery](https://img.shields.io/badge/celery-5.3.6-37814A?logo=celery&logoColor=white)](https://docs.celeryq.dev/en/stable/django/first-steps-with-django.html)
[![redis](https://img.shields.io/badge/redis-5.0.3-DC382D?logo=redis&logoColor=white)](https://redis-py.readthedocs.io/en/stable/)

## Начало работы:

1. **Установка:** Клонируйте репозиторий на свой локальный компьютер.
2. **Настройка окружения:** В корневом каталоге проекта создайте файл .env. Вы
   можете использовать предоставленный файл .env.example в качестве шаблона.
   Убедитесь, что заполнили необходимые переменные окружения своими
   настройками.
3. **Docker Compose:** Перейдите в каталог проекта и выполните следующие
   команды, чтобы запустить приложение с использованием Docker Compose

```bash
docker compose up --build
```

4. **Доступ к приложению:** После того, как Docker Compose закончит настройку
   окружения, вы сможете получить доступ к документации, перейдя по
   адресу http://127.0.0.1/redoc/. 
   Для доступа к админ-зоне пройдите по адресу http://127.0.0.1/admin/, суперпользователь создан автоматически (`логин: admin, пароль:
   admin`)

## Основные возможности

1. **Управление домами**:
    - Получение списка всех домов.
    - Получение подробной информации о конкретном доме, включая список квартир.

2. **Управление квартирами**:
    - Получение списка всех квартир
    - Получение информации о конкретной квартире, включая данные о счетчиках
      воды и их показаниях.
    - Запись показаний счетчиков воды для квартиры.

3. **Расчет коммунальных услуг**:
    - Расчет стоимости коммунальных услуг для дома на основе показаний
      счетчиков воды и других параметров.
    - Получение расчетов стоимости коммунальных услуг для конкретного дома и
      месяца.

## Основные модели данных

- **House (Дом)**: содержит информацию о доме, включая город, улицу и номер
  дома.
- **Apartment (Квартира)**: содержит информацию о квартире, включая номер,
  площадь и привязку к дому.
- **WaterMeter (Счетчик воды)**: содержит информацию о счетчике воды,
  установленном в квартире.
- **WaterMeterReading (Показания счетчика воды)**: содержит данные о показаниях
  счетчика воды на определенную дату.
- **CalculationResult (Результат расчета)**: содержит результаты расчета
  стоимости коммунальных услуг для квартиры на определенный месяц.

## Примеры запросов

1. **Получение списка домов**:
    - `GET /houses/`

2. **Получение информации о конкретном доме**:
    - `GET /houses/{id}/`
   
3. **Получение списка квартир**:
    - `GET /spartments/`

4. **Получение информации о квартире**:
    - `GET /apartment_detail/?city={city}&street={street}&house_number={house_number}&apartment_number={apartment_number}`

5. **Запись показаний счетчиков воды**:
    - `POST /apartment_detail/`
      ```json
      {
        "readings": [
          {
            "meter_id": 165,
            "value": 120.5
          }
        ]
      }
      ```

5. **Расчет стоимости коммунальных услуг для дома**:
    - `POST /calculate_bills/{house_id}/`
      ```json
      {
        "date": "2024-07-19"
      }
      ```

6. **Получение расчета стоимости коммунальных услуг для дома**:
    - `GET /calculate_bills/{house_id}/?date=2024-07-19`

## Использование API

При старте проекта были сгенерированы тестовые данные, которые позволяют
попробовать рассчитать стоимость коммунальных услуг, используя примеры
запросов. Например, используя Postman.

1. Определите `id` дома, в котором есть показания счётчика за три месяца. Для
   этого используйте пункт `3 из примеров запросов` и найдите счётчик под
   названием `кухня`.
2. Используя `id` этого дома, можно рассчитать стоимость коммунальных услуг за
   июнь и июль, используя соответствующие примеры запросов.